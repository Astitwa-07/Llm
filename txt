import os
import fitz  # PyMuPDF
from tika import parser
from googletrans import Translator
from PyPDF2 import PdfWriter

def extract_text_from_pdf(pdf_file):
    raw_text = parser.from_file(pdf_file)
    return raw_text['content']

def translate_text(text):
    translator = Translator()
    result = translator.translate(text, src='de', dest='en')
    return result.text

def clean_text(text):
    # You can add custom text cleaning rules here if required
    return text

def save_text_to_pdf(text, output_file):
    with fitz.open() as doc:
        page = doc.new_page()
        page.insert_text((10, 10), text)

        doc.save(output_file)

def convert_pdf_to_english(input_folder, output_folder):
    os.makedirs(output_folder, exist_ok=True)

    for file_name in os.listdir(input_folder):
        if file_name.lower().endswith('.pdf'):
            input_file = os.path.join(input_folder, file_name)
            pdf_text = extract_text_from_pdf(input_file)

            translated_text = translate_text(pdf_text)
            cleaned_text = clean_text(translated_text)

            output_file = os.path.join(output_folder, file_name[:-4] + '_translated.pdf')
            save_text_to_pdf(cleaned_text, output_file)

if __name__ == "__main__":
    input_folder_path = "/path/to/input/folder"
    output_folder_path = "/path/to/output/folder"
    convert_pdf_to_english(input_folder_path, output_folder_path)